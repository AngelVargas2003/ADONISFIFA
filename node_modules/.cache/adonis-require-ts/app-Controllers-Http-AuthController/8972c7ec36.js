"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
global[Symbol.for('ioc.use')]("App/Models/User");
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class AuthController {
    async Login({ auth, request, response }) {
        const email = request.input('email');
        const password = request.input('password');
        try {
            const user = await User_1.default
                .query()
                .where('email', email)
                .where('password', password)
                .firstOrFail();
            const token = auth.use('api').generate(user);
            return token;
        }
        catch {
            return response.badRequest('Invalid credentials');
        }
    }
    async Logout({ auth, response }) {
        try {
            await auth.use('api').authenticate();
            await auth.use('api').revoke();
            return true;
        }
        catch {
            return response.badRequest('No existe el usuario');
        }
    }
    async VerificarToken({ auth }) {
        try {
            await auth.use('api').authenticate();
            return true;
        }
        catch {
            return false;
        }
    }
    async validarrol({ auth, response }) {
        try {
            await auth.use('api').authenticate();
            const rol = auth.use('api').user.$attributes.rol;
            if (rol == 1) {
                return true;
            }
            else {
                return false;
            }
        }
        catch {
            return response.badRequest('El usuario no existe');
        }
    }
    async getUser({ auth }) {
        await auth.use('api').authenticate();
        const user = auth.use('api').user.$attributes;
        return user;
    }
}
exports.default = AuthController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aENvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBdXRoQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLGlEQUF3QjtBQUN4QixpRkFBa0M7QUFDbEMsTUFBcUIsY0FBYztJQUN4QixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUMsSUFBSSxFQUFDLE9BQU8sRUFBQyxRQUFRLEVBQUM7UUFFdEMsTUFBTSxLQUFLLEdBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNsQyxNQUFNLFFBQVEsR0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ3hDLElBQUc7WUFDQyxNQUFNLElBQUksR0FBQyxNQUFNLGNBQUk7aUJBQ3BCLEtBQUssRUFBRTtpQkFDUCxLQUFLLENBQUMsT0FBTyxFQUFDLEtBQUssQ0FBQztpQkFDcEIsS0FBSyxDQUFDLFVBQVUsRUFBQyxRQUFRLENBQUM7aUJBQzFCLFdBQVcsRUFBRSxDQUFBO1lBQ2QsTUFBTSxLQUFLLEdBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDMUMsT0FBTyxLQUFLLENBQUE7U0FDZjtRQUFBLE1BQ0Q7WUFDSSxPQUFPLFFBQVEsQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsQ0FBQTtTQUNwRDtJQUNMLENBQUM7SUFDTSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFDLFFBQVEsRUFBQztRQUUvQixJQUNBO1lBQ0ksTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFBO1lBQ3BDLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtZQUM5QixPQUFPLElBQUksQ0FBQTtTQUNkO1FBQUEsTUFBSztZQUNGLE9BQU8sUUFBUSxDQUFDLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFBO1NBQ3JEO0lBQ0wsQ0FBQztJQUNNLEtBQUssQ0FBQyxjQUFjLENBQUMsRUFBQyxJQUFJLEVBQUM7UUFFOUIsSUFDQTtZQUNJLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUNwQyxPQUFPLElBQUksQ0FBQTtTQUNkO1FBQUEsTUFDRDtZQUNJLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7SUFDTCxDQUFDO0lBQ00sS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFDLElBQUksRUFBQyxRQUFRLEVBQUM7UUFFbkMsSUFDQTtZQUNJLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUNwQyxNQUFNLEdBQUcsR0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFBO1lBQzlDLElBQUcsR0FBRyxJQUFFLENBQUMsRUFBQztnQkFDUCxPQUFPLElBQUksQ0FBQTthQUNiO2lCQUNHO2dCQUNBLE9BQU8sS0FBSyxDQUFBO2FBQ2Y7U0FDSjtRQUFBLE1BQ0Q7WUFDSSxPQUFPLFFBQVEsQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtTQUNyRDtJQUNMLENBQUM7SUFDTSxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUMsSUFBSSxFQUFDO1FBRXZCLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUNwQyxNQUFNLElBQUksR0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUE7UUFDM0MsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0NBQ0o7QUEvREQsaUNBK0RDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IHR5cGUgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCAnQXBwL01vZGVscy9Vc2VyJ1xuaW1wb3J0IFVzZXIgZnJvbSAnQXBwL01vZGVscy9Vc2VyJ1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0aENvbnRyb2xsZXIge1xuICAgIHB1YmxpYyBhc3luYyBMb2dpbih7YXV0aCxyZXF1ZXN0LHJlc3BvbnNlfSlcbiAgICB7XG4gICAgICAgIGNvbnN0IGVtYWlsPXJlcXVlc3QuaW5wdXQoJ2VtYWlsJylcbiAgICAgICAgY29uc3QgcGFzc3dvcmQ9cmVxdWVzdC5pbnB1dCgncGFzc3dvcmQnKVxuICAgICAgICB0cnl7XG4gICAgICAgICAgICBjb25zdCB1c2VyPWF3YWl0IFVzZXJcbiAgICAgICAgICAgIC5xdWVyeSgpXG4gICAgICAgICAgICAud2hlcmUoJ2VtYWlsJyxlbWFpbClcbiAgICAgICAgICAgIC53aGVyZSgncGFzc3dvcmQnLHBhc3N3b3JkKVxuICAgICAgICAgICAgLmZpcnN0T3JGYWlsKClcbiAgICAgICAgICAgIGNvbnN0IHRva2VuPWF1dGgudXNlKCdhcGknKS5nZW5lcmF0ZSh1c2VyKVxuICAgICAgICAgICAgcmV0dXJuIHRva2VuXG4gICAgICAgIH1jYXRjaFxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCgnSW52YWxpZCBjcmVkZW50aWFscycpXG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGFzeW5jIExvZ291dCh7YXV0aCxyZXNwb25zZX0pXG4gICAge1xuICAgICAgICB0cnlcbiAgICAgICAge1xuICAgICAgICAgICAgYXdhaXQgYXV0aC51c2UoJ2FwaScpLmF1dGhlbnRpY2F0ZSgpXG4gICAgICAgICAgICBhd2FpdCBhdXRoLnVzZSgnYXBpJykucmV2b2tlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1jYXRjaHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KCdObyBleGlzdGUgZWwgdXN1YXJpbycpXG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGFzeW5jIFZlcmlmaWNhclRva2VuKHthdXRofSlcbiAgICB7XG4gICAgICAgIHRyeVxuICAgICAgICB7XG4gICAgICAgICAgICBhd2FpdCBhdXRoLnVzZSgnYXBpJykuYXV0aGVudGljYXRlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1jYXRjaFxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgdmFsaWRhcnJvbCh7YXV0aCxyZXNwb25zZX0pXG4gICAge1xuICAgICAgICB0cnlcbiAgICAgICAge1xuICAgICAgICAgICAgYXdhaXQgYXV0aC51c2UoJ2FwaScpLmF1dGhlbnRpY2F0ZSgpXG4gICAgICAgICAgICBjb25zdCByb2w9YXV0aC51c2UoJ2FwaScpLnVzZXIuJGF0dHJpYnV0ZXMucm9sXG4gICAgICAgICAgICBpZihyb2w9PTEpe1xuICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1jYXRjaFxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCgnRWwgdXN1YXJpbyBubyBleGlzdGUnKVxuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBhc3luYyBnZXRVc2VyKHthdXRofSlcbiAgICB7XG4gICAgICAgIGF3YWl0IGF1dGgudXNlKCdhcGknKS5hdXRoZW50aWNhdGUoKVxuICAgICAgICBjb25zdCB1c2VyPWF1dGgudXNlKCdhcGknKS51c2VyLiRhdHRyaWJ1dGVzXG4gICAgICAgIHJldHVybiB1c2VyXG4gICAgfVxufVxuIl19